<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpringAI 智能聊天</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/chat.css">
</head>
<body>
    <div class="app-container">
        <!-- 知识库管理面板 -->
        <div class="knowledge-panel">
            <div class="panel-header">
                <h3>知识库管理</h3>
            </div>
            
            <div class="kb-controls">
                <div class="toggle-switch">
                    <label>开启知识库问答</label>
                    <label class="switch">
                        <input type="checkbox" id="ragToggle" onchange="toggleRagMode()">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <button class="btn-primary" onclick="createNewKnowledgeBase()" style="width: 100%; margin-bottom: 10px;">
                    + 新建知识库
                </button>
            </div>
            
            <div class="kb-list" id="kbList">
                <!-- 知识库列表将动态生成 -->
                <div class="kb-item active" data-kb-id="default">
                    <div class="kb-name">默认知识库</div>
                    <div class="kb-description">系统默认知识库</div>
                    <div class="kb-actions">
                        <button class="btn-small delete" onclick="deleteKnowledgeBase('default')">删除</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 聊天主面板 -->
        <div class="chat-panel">
            <div class="chat-header">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>智能聊天助手</h2>
                    <button class="btn-small new-conversation" onclick="newConversation()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 16px; border-radius: 8px; border: none; cursor: pointer; font-size: 14px;">
                        新建会话
                    </button>
                </div>
            </div>
            
            <div class="messages" id="messages"></div>
            
            <div class="input-area">
                <div class="input-container">
                    <div class="input-wrapper">
                        <textarea 
                            id="userInput" 
                            placeholder="请输入你的消息..." 
                            onkeydown="handleKeyDown(event)"
                        ></textarea>
                        <button class="send-btn" onclick="sendMessage()" id="sendBtn">
                            <span class="send-icon">→</span>
                            <span class="interrupt-icon">×</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 上传文件弹出框 -->
    <div class="upload-modal" id="uploadModal">
        <div class="upload-modal-content">
            <div class="upload-modal-header">
                <h3>上传文件到知识库</h3>
                <button class="close-modal" onclick="closeUploadModal()">&times;</button>
            </div>
            <div class="upload-modal-body">
                <div class="file-select-area">
                    <p>支持上传 PDF, DOC, DOCX, TXT 等格式文件</p>
                    <input type="file" id="fileUpload" accept=".pdf,.doc,.docx,.txt" multiple style="display: none;" onchange="handleFileSelect(event)">
                    <button class="btn-primary" onclick="document.getElementById('fileUpload').click()">
                        选择文件
                    </button>
                    <div class="selected-files" id="selectedFiles"></div>
                </div>
                <div class="upload-progress" id="uploadProgress">
                    <div class="upload-bar" id="uploadBar"></div>
                </div>
            </div>
            <div class="upload-modal-footer">
                <button class="btn-secondary" onclick="closeUploadModal()">取消</button>
                <button class="btn-primary" onclick="uploadFile()" id="startUploadBtn" disabled>
                    开始上传
                </button>
            </div>
        </div>
    </div>
    
    <!-- 新建知识库弹出框 -->
    <div class="upload-modal" id="createKbModal">
        <div class="upload-modal-content">
            <div class="upload-modal-header">
                <h3>新建知识库</h3>
                <button class="close-modal" onclick="closeCreateKbModal()">&times;</button>
            </div>
            <div class="upload-modal-body">
                <div class="mb-3">
                    <label for="kbName" class="form-label">知识库名称</label>
                    <input type="text" class="form-control" id="kbName" placeholder="请输入知识库名称">
                </div>
                <div class="mb-3">
                    <label for="kbDescription" class="form-label">知识库描述</label>
                    <textarea class="form-control" id="kbDescription" rows="3" placeholder="请输入知识库描述"></textarea>
                </div>
            </div>
            <div class="upload-modal-footer">
                <button class="btn-secondary" onclick="closeCreateKbModal()">取消</button>
                <button class="btn-primary" onclick="createKnowledgeBaseConfirm()">确认创建</button>
            </div>
        </div>
    </div>
    
    <script src="js/chat.js"></script>
</body>
</html>